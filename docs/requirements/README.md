# CAPD支援アプリ 要件定義ドキュメント

## 1. 目的
本ディレクトリは、次セッションの実装エージェントがそのまま設計・実装・テストへ進めるための、決定済み要件一式です。  
中核方針は次の3点です。

- CSV設定駆動で手技を実行すること
- 安全上重要な工程で進行ブロックを行うこと
- 版管理付きで手技変更を継続運用できること

## 2. ドキュメント構成
1. `01_scope_and_success.md`: スコープ、対象、成功基準
2. `02_operational_flow.md`: 日次運用と業務フロー
3. `03_protocol_csv_v3_spec.md`: CSV v3仕様と取り込み検証
4. `04_domain_model_and_interfaces.md`: ドメインモデル、正規化JSON、API I/F
5. `05_functional_requirements.md`: 機能要件一覧
6. `06_ui_wireframes_ab.md`: UI A/Bワイヤーと遷移
7. `07_acceptance_tests.md`: 受入テスト
8. `08_risks_and_constraints.md`: リスクと制約

## 3. 参照順
1. `01_scope_and_success.md`
2. `02_operational_flow.md`
3. `03_protocol_csv_v3_spec.md`
4. `04_domain_model_and_interfaces.md`
5. `05_functional_requirements.md`
6. `06_ui_wireframes_ab.md`
7. `07_acceptance_tests.md`
8. `08_risks_and_constraints.md`

## 4. 用語集
- 手技テンプレート: 1回のセッションで実行する一連ステップ定義（CSV取り込み単位）
- セッション: 手技テンプレートを1回実行する実績単位
- 手順スナップショット: セッション開始時点の手技定義を固定保存したもの
- 重要工程: 必須チェックまたは必須記録により遷移ブロックされる工程
- `record_event`: 手動入力モーダルを起動するイベント識別子
- `timer_id`: 自動時刻記録の論理タイマー識別子

## 5. 前提（確定事項）
- 要件書は日本語のみで作成します。
- アプリ利用は本人のみを想定します。
- 1セッション=1手技テンプレートです。
- ホームでは複数手技テンプレートから選択して開始します。
- 通信要件はオンライン必須です。
- 保存方針はクラウドのみ（端末保存は最小キャッシュ）です。
- 起動認証は行いません（端末ロック前提）。
- 医療免責文の常設表示は行いません。
- 異常時導線は警告表示のみ（連絡ボタン等はv1対象外）です。

## 6. 現状ベースライン
現状分析のベースCSV:

- `/Users/sakanet/Downloads/手技マニュアル_ワンバッグ_v2 - 手技マニュアル_v2 (1).csv`

確認済み事実:

- ステップ数: 76
- フェーズ数: 7（事前準備、接続、廃液、注液、切り離し、透析中、終了）
- 状態数: 4（お腹-独立、お腹-接続、お腹→廃液バッグ、お腹←透析液バッグ）

## 7. 意思決定ログ（2026-02-09）
| 項目 | 決定 |
|---|---|
| CSVフォーマット | v3のみ対応 |
| CSVメタ情報 | `row_type=meta` 行で先頭に保持 |
| 分岐 | 不可（完全シリアル遷移のみ） |
| 必須チェック数列 | 廃止（改行行数を正とする） |
| 進行制御 | 重要工程と `record_event` でブロック |
| 通知 | 1日1回の全体リマインド |
| 待機アラーム | 1回通知のみ（再通知なし） |
| 廃液見た目分類 | 透明/やや混濁/混濁/血性/その他 |
| 廃液写真 | 常に任意 |
| 手順変更履歴 | セッション開始時にスナップショット保存 |

## 8. 実装者向け注意
- 本要件は「設計・実装の判断を残さない」ことを目的にしています。あいまいな点は `08_risks_and_constraints.md` の明示前提に従います。
- CSV内のプレースホルダ文言（例: `xx分`, `(これはなんだろう)`）は品質警告として扱い、取り込み時に可視化します。
