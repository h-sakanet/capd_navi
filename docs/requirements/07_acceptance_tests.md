# 07. 受入テスト

## 1. テスト方針
- 本仕様の判定は「安全制御」「記録完全性」「CSV整合性」を最優先に行います。
- 1件エラーで取り込み中止の原則を検証します。

## 2. 必須シナリオ

### 2.1 CSV取込
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-CSV-001 | 正常取込 | 正常CSV v3 | 取込実行 | 成功しテンプレート登録 |
| AT-CSV-002 | 重複検出 | `step_id`重複CSV | 取込実行 | エラーで中止 |
| AT-CSV-003 | 直列整合 | `next_step_id`不整合CSV | 取込実行 | エラーで中止 |
| AT-CSV-004 | 画像存在 | 画像不足CSV | 取込実行 | エラーで中止 |
| AT-CSV-005 | 警告検知 | `xx分`含有CSV | 取込実行 | 取込成功 + 警告表示 |

### 2.2 進行制御
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-FLOW-001 | 必須チェック | 必須チェックありステップ | 未チェックで次へ | 遷移不可 |
| AT-FLOW-002 | 記録ゲート | `record_event`ステップ | 未保存で次へ | 遷移不可 |
| AT-FLOW-003 | 直列遷移 | 通常ステップ | 次へ | `next_step_id`へ遷移 |

### 2.3 タイマー/アラーム
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-TIMER-001 | start記録 | `timer_event=start`ステップ | 到達 | 自動時刻記録 |
| AT-TIMER-002 | end記録 | `timer_event=end`ステップ | 到達 | 自動時刻記録 |
| AT-ALARM-001 | 1回通知 | `alarm_trigger=step_enter` | ステップ到達 | 通知1回のみ |

### 2.4 記録
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-REC-001 | 見た目分類 | `drain_appearance` | 分類選択し保存 | 保存成功 |
| AT-REC-002 | 写真任意 | `drain_appearance` | 写真なし保存 | 保存成功 |
| AT-REC-003 | 単位整合 | `drain_weight_g` | gで入力保存 | 保存成功 |
| AT-REC-004 | 必須入力 | `session_summary` | 必須欠落で保存 | 保存失敗 |

### 2.5 版履歴
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-VERSION-001 | スナップショット保持 | v1で開始済セッションあり | v2取込後に旧セッション参照 | v1内容で再現 |

### 2.6 UI
| ID | 観点 | 前提 | 操作 | 期待結果 |
|---|---|---|---|---|
| AT-UI-001 | フェーズ/状態表示 | セッション中 | 各ステップ表示 | 常時表示される |
| AT-UI-002 | 警告視認性 | 警告文ありステップ | 画面表示 | 通常文より強調表示 |
| AT-UI-003 | A/B整合 | A/Bワイヤー実装 | 主要遷移確認 | 共通遷移を満たす |

## 3. 境界値テスト
- 必須チェック0件ステップで遷移可能か
- 最終ステップのみ `next_step_id` 空欄許容か
- セル内改行を含む `必須チェック` が正しく分割されるか
- `alarm_duration_min` の最小値（1分）で通知されるか

## 4. 回帰テスト観点
- CSVパーサ更新で既存v3が読めなくならないこと
- 記録モーダル追加時に進行ブロック条件が崩れないこと
- 版管理変更時にスナップショット再現性が維持されること
