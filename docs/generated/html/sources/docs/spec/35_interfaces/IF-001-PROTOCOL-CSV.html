<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>docs/spec/35_interfaces/IF-001-PROTOCOL-CSV.md ソース表示</title>
  <style>
    :root { color-scheme: light; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f6f8fb; color: #1f2937; }
    .top-nav { display: flex; gap: 16px; padding: 14px 20px; border-bottom: 1px solid #d7deea; background: #ffffff; }
    .top-nav a { color: #0f4acb; text-decoration: none; font-weight: 600; }
    .top-nav a:hover { text-decoration: underline; }
    main { max-width: 1180px; margin: 0 auto; padding: 24px 20px 40px; }
    h1 { margin: 0 0 12px; font-size: 1.6rem; }
    h2 { margin: 0 0 10px; font-size: 1.1rem; }
    .lead { margin: 0 0 18px; color: #4b5563; }
    .card { background: #ffffff; border: 1px solid #d7deea; border-radius: 10px; padding: 16px; margin-bottom: 14px; }
    ul { margin: 8px 0 0; padding-left: 1.2rem; }
    ol { margin: 8px 0 0; padding-left: 1.4rem; }
    li { margin: 4px 0; }
    a { color: #0f4acb; text-decoration: none; }
    a:hover { text-decoration: underline; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #eef3ff; border-radius: 4px; padding: 1px 4px; }
    .muted { color: #6b7280; font-size: 0.92rem; }
    .source-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .source-table td { border-bottom: 1px solid #e5e7eb; vertical-align: top; padding: 2px 8px; }
    .source-table .line { width: 82px; text-align: right; color: #6b7280; background: #ffffff; }
    .source-table .line a { color: #6b7280; }
    .source-table .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre; overflow-wrap: anywhere; }
    .pill { display: inline-block; border: 1px solid #d7deea; border-radius: 999px; padding: 2px 8px; font-size: 0.78rem; color: #475569; margin-right: 6px; }
  </style>
</head>
<body>
  <nav class="top-nav"><a href="../../../../index.html">HTML Index</a><a href="../../../../../index.md">Markdown Index</a></nav>
  <main>
    <h1>docs/spec/35_interfaces/IF-001-PROTOCOL-CSV.md ソース表示</h1>
    <p class="lead">行番号とIDアンカー付きで参照できます。</p>
    <section class="card">
  <h2><code>docs/spec/35_interfaces/IF-001-PROTOCOL-CSV.md</code></h2>
  <table class="source-table">
<tr id="L1">
  <td class="line"><a href="#L1">1</a></td>
  <td class="code"># IF-001-PROTOCOL-CSV</td>
</tr>
<tr id="L2">
  <td class="line"><a href="#L2">2</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L3">
  <td class="line"><a href="#L3">3</a></td>
  <td class="code">## 0. メタ情報</td>
</tr>
<tr id="L4">
  <td class="line"><a href="#L4">4</a></td>
  <td class="code">- IF ID: IF-001-PROTOCOL-CSV</td>
</tr>
<tr id="L5">
  <td class="line"><a href="#L5">5</a></td>
  <td class="code">- 名称: protocol.csv</td>
</tr>
<tr id="L6">
  <td class="line"><a href="#L6">6</a></td>
  <td class="code">- 種別: ファイルI/F（CSV + 画像ディレクトリ）</td>
</tr>
<tr id="L7">
  <td class="line"><a href="#L7">7</a></td>
  <td class="code">- 関連画面: `../20_screens/<a href="../../../../screens/SCR-012-MAC-IMPORT.html">SCR-012-MAC-IMPORT</a>.md`</td>
</tr>
<tr id="L8">
  <td class="line"><a href="#L8">8</a></td>
  <td class="code">- 関連機能: `../30_capabilities/CAP-CSV-IMPORT-001.md`</td>
</tr>
<tr id="L9">
  <td class="line"><a href="#L9">9</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L10">
  <td class="line"><a href="#L10">10</a></td>
  <td class="code"># protocol.csv 詳細仕様</td>
</tr>
<tr id="L11">
  <td class="line"><a href="#L11">11</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L12">
  <td class="line"><a href="#L12">12</a></td>
  <td class="code">## 1. 目的</td>
</tr>
<tr id="L13">
  <td class="line"><a href="#L13">13</a></td>
  <td class="code">Googleスプレッドシートで編集したCSVを、Macから画像群と一緒に取り込み、画面描画用JSONへ正規化する仕様です。</td>
</tr>
<tr id="L14">
  <td class="line"><a href="#L14">14</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L15">
  <td class="line"><a href="#L15">15</a></td>
  <td class="code">## 2. 対応バージョン</td>
</tr>
<tr id="L16">
  <td class="line"><a href="#L16">16</a></td>
  <td class="code">- 対応: `format_version` を持つCSV（サポート対象版）</td>
</tr>
<tr id="L17">
  <td class="line"><a href="#L17">17</a></td>
  <td class="code">- 非対応: `format_version` 欠落または未サポート値</td>
</tr>
<tr id="L18">
  <td class="line"><a href="#L18">18</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L19">
  <td class="line"><a href="#L19">19</a></td>
  <td class="code">## 3. 取り込み単位（v1固定）</td>
</tr>
<tr id="L20">
  <td class="line"><a href="#L20">20</a></td>
  <td class="code">- 取り込みは Mac ネイティブシェルからのみ実行します。</td>
</tr>
<tr id="L21">
  <td class="line"><a href="#L21">21</a></td>
  <td class="code">- 入力は「1ディレクトリ単位」です。</td>
</tr>
<tr id="L22">
  <td class="line"><a href="#L22">22</a></td>
  <td class="code">- ディレクトリ内に `protocol.csv` を必須とします。</td>
</tr>
<tr id="L23">
  <td class="line"><a href="#L23">23</a></td>
  <td class="code">- 画像は `protocol.csv` からの相対パスで解決できる位置に配置します。</td>
</tr>
<tr id="L24">
  <td class="line"><a href="#L24">24</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L25">
  <td class="line"><a href="#L25">25</a></td>
  <td class="code">例:</td>
</tr>
<tr id="L26">
  <td class="line"><a href="#L26">26</a></td>
  <td class="code">```text</td>
</tr>
<tr id="L27">
  <td class="line"><a href="#L27">27</a></td>
  <td class="code">protocol_package/</td>
</tr>
<tr id="L28">
  <td class="line"><a href="#L28">28</a></td>
  <td class="code">  protocol.csv</td>
</tr>
<tr id="L29">
  <td class="line"><a href="#L29">29</a></td>
  <td class="code">  assets/</td>
</tr>
<tr id="L30">
  <td class="line"><a href="#L30">30</a></td>
  <td class="code">    handwash.png</td>
</tr>
<tr id="L31">
  <td class="line"><a href="#L31">31</a></td>
  <td class="code">    step_021.png</td>
</tr>
<tr id="L32">
  <td class="line"><a href="#L32">32</a></td>
  <td class="code">```</td>
</tr>
<tr id="L33">
  <td class="line"><a href="#L33">33</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L34">
  <td class="line"><a href="#L34">34</a></td>
  <td class="code">## 4. CSVファイル仕様</td>
</tr>
<tr id="L35">
  <td class="line"><a href="#L35">35</a></td>
  <td class="code">- 文字コード: UTF-8</td>
</tr>
<tr id="L36">
  <td class="line"><a href="#L36">36</a></td>
  <td class="code">- 区切り: カンマ</td>
</tr>
<tr id="L37">
  <td class="line"><a href="#L37">37</a></td>
  <td class="code">- 改行: LF/CRLFの両方を許容</td>
</tr>
<tr id="L38">
  <td class="line"><a href="#L38">38</a></td>
  <td class="code">- セル内改行: ダブルクォートで囲まれた改行を許容</td>
</tr>
<tr id="L39">
  <td class="line"><a href="#L39">39</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L40">
  <td class="line"><a href="#L40">40</a></td>
  <td class="code">## 5. 列仕様（推奨順）</td>
</tr>
<tr id="L41">
  <td class="line"><a href="#L41">41</a></td>
  <td class="code">`row_type,meta_key,meta_value,通し番号,step_id,next_step_id,フェーズ,状態,タイトル,画像,表示テキスト,警告テキスト,必須チェック,timer_id,timer_event,timer_exchange_no,timer_segment,alarm_id,alarm_trigger,alarm_duration_min,alarm_related_timer_id,record_event,record_exchange_no,record_unit`</td>
</tr>
<tr id="L42">
  <td class="line"><a href="#L42">42</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L43">
  <td class="line"><a href="#L43">43</a></td>
  <td class="code">### 5.1 `row_type=meta` 行</td>
</tr>
<tr id="L44">
  <td class="line"><a href="#L44">44</a></td>
  <td class="code">- `meta_key`, `meta_value` を必須とします。</td>
</tr>
<tr id="L45">
  <td class="line"><a href="#L45">45</a></td>
  <td class="code">- その他列は空欄とします。</td>
</tr>
<tr id="L46">
  <td class="line"><a href="#L46">46</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L47">
  <td class="line"><a href="#L47">47</a></td>
  <td class="code">必須メタキー:</td>
</tr>
<tr id="L48">
  <td class="line"><a href="#L48">48</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L49">
  <td class="line"><a href="#L49">49</a></td>
  <td class="code">- `format_version`（サポート対象版の識別子）</td>
</tr>
<tr id="L50">
  <td class="line"><a href="#L50">50</a></td>
  <td class="code">- `protocol_id`</td>
</tr>
<tr id="L51">
  <td class="line"><a href="#L51">51</a></td>
  <td class="code">- `protocol_name`</td>
</tr>
<tr id="L52">
  <td class="line"><a href="#L52">52</a></td>
  <td class="code">- `protocol_version`</td>
</tr>
<tr id="L53">
  <td class="line"><a href="#L53">53</a></td>
  <td class="code">- `effective_from_local`（端末ローカル日時文字列）</td>
</tr>
<tr id="L54">
  <td class="line"><a href="#L54">54</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L55">
  <td class="line"><a href="#L55">55</a></td>
  <td class="code">### 5.2 `row_type=step` 行</td>
</tr>
<tr id="L56">
  <td class="line"><a href="#L56">56</a></td>
  <td class="code">主要必須列:</td>
</tr>
<tr id="L57">
  <td class="line"><a href="#L57">57</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L58">
  <td class="line"><a href="#L58">58</a></td>
  <td class="code">- `step_id`</td>
</tr>
<tr id="L59">
  <td class="line"><a href="#L59">59</a></td>
  <td class="code">- `next_step_id`（最終行のみ空許容）</td>
</tr>
<tr id="L60">
  <td class="line"><a href="#L60">60</a></td>
  <td class="code">- `フェーズ`</td>
</tr>
<tr id="L61">
  <td class="line"><a href="#L61">61</a></td>
  <td class="code">- `状態`</td>
</tr>
<tr id="L62">
  <td class="line"><a href="#L62">62</a></td>
  <td class="code">- `タイトル`</td>
</tr>
<tr id="L63">
  <td class="line"><a href="#L63">63</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L64">
  <td class="line"><a href="#L64">64</a></td>
  <td class="code">条件付き列:</td>
</tr>
<tr id="L65">
  <td class="line"><a href="#L65">65</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L66">
  <td class="line"><a href="#L66">66</a></td>
  <td class="code">- `必須チェック`: 改行区切りで複数定義可</td>
</tr>
<tr id="L67">
  <td class="line"><a href="#L67">67</a></td>
  <td class="code">- `timer_id` 使用時は `timer_event` も必須</td>
</tr>
<tr id="L68">
  <td class="line"><a href="#L68">68</a></td>
  <td class="code">- `timer_segment` は、貯留/廃液の時刻表示または通知対象判定が必要な行で使用します（非対象タイマーは空欄可）</td>
</tr>
<tr id="L69">
  <td class="line"><a href="#L69">69</a></td>
  <td class="code">- `timer_event=end` かつ `timer_segment=dwell/drain` の行では `alarm_id` を必須</td>
</tr>
<tr id="L70">
  <td class="line"><a href="#L70">70</a></td>
  <td class="code">- `alarm_trigger`, `alarm_duration_min`, `alarm_related_timer_id` は互換維持のため受理しますが、v1運用では未使用です</td>
</tr>
<tr id="L71">
  <td class="line"><a href="#L71">71</a></td>
  <td class="code">- `record_event` 使用時は必要に応じて `record_exchange_no`, `record_unit` を併用</td>
</tr>
<tr id="L72">
  <td class="line"><a href="#L72">72</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L73">
  <td class="line"><a href="#L73">73</a></td>
  <td class="code">## 6. 列の意味</td>
</tr>
<tr id="L74">
  <td class="line"><a href="#L74">74</a></td>
  <td class="code">- `step_id`, `next_step_id`: 完全シリアル遷移（分岐なし）</td>
</tr>
<tr id="L75">
  <td class="line"><a href="#L75">75</a></td>
  <td class="code">- `フェーズ`, `状態`: UI常時表示用の文脈ラベル</td>
</tr>
<tr id="L76">
  <td class="line"><a href="#L76">76</a></td>
  <td class="code">- `タイトル`, `画像`, `表示テキスト`, `警告テキスト`: 画面表示コンテンツ</td>
</tr>
<tr id="L77">
  <td class="line"><a href="#L77">77</a></td>
  <td class="code">- `必須チェック`: チェックボックス表示と進行ブロック制御</td>
</tr>
<tr id="L78">
  <td class="line"><a href="#L78">78</a></td>
  <td class="code">- `timer_*`: 自動時刻記録</td>
</tr>
<tr id="L79">
  <td class="line"><a href="#L79">79</a></td>
  <td class="code">- `alarm_id`: タイマー終了通知ジョブの識別子（同一セッション内の通知対象行で一意）</td>
</tr>
<tr id="L80">
  <td class="line"><a href="#L80">80</a></td>
  <td class="code">- `alarm_*`（`alarm_trigger`, `alarm_duration_min`, `alarm_related_timer_id`）: 互換維持列（v1運用では未使用）</td>
</tr>
<tr id="L81">
  <td class="line"><a href="#L81">81</a></td>
  <td class="code">- `record_*`: 手動記録モーダル起動条件</td>
</tr>
<tr id="L82">
  <td class="line"><a href="#L82">82</a></td>
  <td class="code">- `record_exchange_no`: 記録ノート交換列（左から `1`〜`5`）への割当キー</td>
</tr>
<tr id="L83">
  <td class="line"><a href="#L83">83</a></td>
  <td class="code">- `timer_exchange_no`: 時刻記録の交換列（左から `1`〜`5`）への割当キー</td>
</tr>
<tr id="L84">
  <td class="line"><a href="#L84">84</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L85">
  <td class="line"><a href="#L85">85</a></td>
  <td class="code">## 7. 画像パス解決</td>
</tr>
<tr id="L86">
  <td class="line"><a href="#L86">86</a></td>
  <td class="code">- `画像` 列は `protocol.csv` 配置ディレクトリ基準の相対パスです。</td>
</tr>
<tr id="L87">
  <td class="line"><a href="#L87">87</a></td>
  <td class="code">- 版サブフォルダを含めることを推奨します（例: `assets/手洗い.png`）。</td>
</tr>
<tr id="L88">
  <td class="line"><a href="#L88">88</a></td>
  <td class="code">- ファイル未存在は取り込みエラーです。</td>
</tr>
<tr id="L89">
  <td class="line"><a href="#L89">89</a></td>
  <td class="code">- 取り込み後、画像はオブジェクトストレージへ保存され、配信URLへ変換して参照します。</td>
</tr>
<tr id="L90">
  <td class="line"><a href="#L90">90</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L91">
  <td class="line"><a href="#L91">91</a></td>
  <td class="code">## 8. 値ドメイン（v1固定）</td>
</tr>
<tr id="L92">
  <td class="line"><a href="#L92">92</a></td>
  <td class="code">- `timer_event`: `start` / `end`</td>
</tr>
<tr id="L93">
  <td class="line"><a href="#L93">93</a></td>
  <td class="code">- `timer_segment`: `dwell` / `drain`（定義時。通知/ノート表示の対象セグメント。非対象タイマーは空欄可）</td>
</tr>
<tr id="L94">
  <td class="line"><a href="#L94">94</a></td>
  <td class="code">- `alarm_id`: 文字列（同一セッション内の通知対象行で重複不可）</td>
</tr>
<tr id="L95">
  <td class="line"><a href="#L95">95</a></td>
  <td class="code">- `record_event`: `drain_appearance` / `drain_weight_g` / `bag_weight_g` / `session_summary`</td>
</tr>
<tr id="L96">
  <td class="line"><a href="#L96">96</a></td>
  <td class="code">- `record_unit`（v1実績）: `g`</td>
</tr>
<tr id="L97">
  <td class="line"><a href="#L97">97</a></td>
  <td class="code">- `record_exchange_no`: `1`〜`5`</td>
</tr>
<tr id="L98">
  <td class="line"><a href="#L98">98</a></td>
  <td class="code">- `timer_exchange_no`: `1`〜`5`</td>
</tr>
<tr id="L99">
  <td class="line"><a href="#L99">99</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L100">
  <td class="line"><a href="#L100">100</a></td>
  <td class="code">## 9. バリデーション</td>
</tr>
<tr id="L101">
  <td class="line"><a href="#L101">101</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L102">
  <td class="line"><a href="#L102">102</a></td>
  <td class="code">### 9.1 エラー（1件でも取り込み中止）</td>
</tr>
<tr id="L103">
  <td class="line"><a href="#L103">103</a></td>
  <td class="code">- `row_type` が `meta` / `step` 以外</td>
</tr>
<tr id="L104">
  <td class="line"><a href="#L104">104</a></td>
  <td class="code">- 必須メタキー欠落</td>
</tr>
<tr id="L105">
  <td class="line"><a href="#L105">105</a></td>
  <td class="code">- `step_id` 重複</td>
</tr>
<tr id="L106">
  <td class="line"><a href="#L106">106</a></td>
  <td class="code">- `next_step_id` 不整合（完全シリアル違反）</td>
</tr>
<tr id="L107">
  <td class="line"><a href="#L107">107</a></td>
  <td class="code">- `timer_event` が `start/end` 以外</td>
</tr>
<tr id="L108">
  <td class="line"><a href="#L108">108</a></td>
  <td class="code">- `timer_segment` が空欄以外で `dwell/drain` 以外</td>
</tr>
<tr id="L109">
  <td class="line"><a href="#L109">109</a></td>
  <td class="code">- 同一 `timer_id` の整合違反（start/end不備）</td>
</tr>
<tr id="L110">
  <td class="line"><a href="#L110">110</a></td>
  <td class="code">- `timer_event=end` かつ `timer_segment=dwell/drain` の行で `alarm_id` が空</td>
</tr>
<tr id="L111">
  <td class="line"><a href="#L111">111</a></td>
  <td class="code">- 同一セッション内で、通知対象行（`timer_event=end` かつ `timer_segment=dwell/drain`）の `alarm_id` が重複</td>
</tr>
<tr id="L112">
  <td class="line"><a href="#L112">112</a></td>
  <td class="code">- `record_event` が定義外値</td>
</tr>
<tr id="L113">
  <td class="line"><a href="#L113">113</a></td>
  <td class="code">- `画像` 指定ファイルが存在しない</td>
</tr>
<tr id="L114">
  <td class="line"><a href="#L114">114</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L115">
  <td class="line"><a href="#L115">115</a></td>
  <td class="code">### 9.2 警告（取り込み可能だが修正推奨）</td>
</tr>
<tr id="L116">
  <td class="line"><a href="#L116">116</a></td>
  <td class="code">- `xx分` など未確定時間表現</td>
</tr>
<tr id="L117">
  <td class="line"><a href="#L117">117</a></td>
  <td class="code">- `(これはなんだろう)` など未確定文言</td>
</tr>
<tr id="L118">
  <td class="line"><a href="#L118">118</a></td>
  <td class="code">- ダミー電話番号等のプレースホルダ</td>
</tr>
<tr id="L119">
  <td class="line"><a href="#L119">119</a></td>
  <td class="code">- `alarm_trigger`, `alarm_duration_min`, `alarm_related_timer_id` が設定されている（v1では未使用）</td>
</tr>
<tr id="L120">
  <td class="line"><a href="#L120">120</a></td>
  <td class="code">- 通知対象外行（`timer_event=end` かつ `timer_segment=dwell/drain` 以外）に `alarm_id` が設定されている（一意性エラー判定の対象外）</td>
</tr>
<tr id="L121">
  <td class="line"><a href="#L121">121</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L122">
  <td class="line"><a href="#L122">122</a></td>
  <td class="code">## 10. 取り込み処理手順</td>
</tr>
<tr id="L123">
  <td class="line"><a href="#L123">123</a></td>
  <td class="code">1. Macでディレクトリ選択</td>
</tr>
<tr id="L124">
  <td class="line"><a href="#L124">124</a></td>
  <td class="code">2. `protocol.csv` 存在確認</td>
</tr>
<tr id="L125">
  <td class="line"><a href="#L125">125</a></td>
  <td class="code">3. 構文パース（改行セル対応）</td>
</tr>
<tr id="L126">
  <td class="line"><a href="#L126">126</a></td>
  <td class="code">4. `meta` 行検証</td>
</tr>
<tr id="L127">
  <td class="line"><a href="#L127">127</a></td>
  <td class="code">5. `step` 行検証</td>
</tr>
<tr id="L128">
  <td class="line"><a href="#L128">128</a></td>
  <td class="code">6. 画像存在検証</td>
</tr>
<tr id="L129">
  <td class="line"><a href="#L129">129</a></td>
  <td class="code">7. エラー有無判定（1件でも中止）</td>
</tr>
<tr id="L130">
  <td class="line"><a href="#L130">130</a></td>
  <td class="code">8. 警告収集</td>
</tr>
<tr id="L131">
  <td class="line"><a href="#L131">131</a></td>
  <td class="code">9. 正規化JSON生成</td>
</tr>
<tr id="L132">
  <td class="line"><a href="#L132">132</a></td>
  <td class="code">10. テンプレート版として保存</td>
</tr>
<tr id="L133">
  <td class="line"><a href="#L133">133</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L134">
  <td class="line"><a href="#L134">134</a></td>
  <td class="code">## 11. ローカル取り込みI/F（公開APIなし）</td>
</tr>
<tr id="L135">
  <td class="line"><a href="#L135">135</a></td>
  <td class="code">- v1 のCSV取り込みは公開HTTP APIを持たず、Macローカル処理で完結します。</td>
</tr>
<tr id="L136">
  <td class="line"><a href="#L136">136</a></td>
  <td class="code">- 取り込みI/Fは次を公開契約とします。</td>
</tr>
<tr id="L137">
  <td class="line"><a href="#L137">137</a></td>
  <td class="code">  - `ProtocolImportService.importFromDirectory(input: { basePath: string }): Promise&lt;ImportResult&gt;`</td>
</tr>
<tr id="L138">
  <td class="line"><a href="#L138">138</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L139">
  <td class="line"><a href="#L139">139</a></td>
  <td class="code">```ts</td>
</tr>
<tr id="L140">
  <td class="line"><a href="#L140">140</a></td>
  <td class="code">type ImportResult = {</td>
</tr>
<tr id="L141">
  <td class="line"><a href="#L141">141</a></td>
  <td class="code">  status: &quot;success&quot; | &quot;failed&quot;;</td>
</tr>
<tr id="L142">
  <td class="line"><a href="#L142">142</a></td>
  <td class="code">  errors: Array&lt;{ row?: number; field?: string; message: string }&gt;;</td>
</tr>
<tr id="L143">
  <td class="line"><a href="#L143">143</a></td>
  <td class="code">  warnings: Array&lt;{ row?: number; field?: string; message: string }&gt;;</td>
</tr>
<tr id="L144">
  <td class="line"><a href="#L144">144</a></td>
  <td class="code">  summary: { stepCount: number; timerCount: number; alarmCount: number; recordEventCount: number };</td>
</tr>
<tr id="L145">
  <td class="line"><a href="#L145">145</a></td>
  <td class="code">};</td>
</tr>
<tr id="L146">
  <td class="line"><a href="#L146">146</a></td>
  <td class="code">```</td>
</tr>
<tr id="L147">
  <td class="line"><a href="#L147">147</a></td>
  <td class="code">&nbsp;</td>
</tr>
<tr id="L148">
  <td class="line"><a href="#L148">148</a></td>
  <td class="code">## 12. 開始時スナップショット固定（実行契約）</td>
</tr>
<tr id="L149">
  <td class="line"><a href="#L149">149</a></td>
  <td class="code">- `SessionService.startSession` 実行時は、取り込み済み `ProtocolPackage` から以下を `SessionProtocolSnapshot` に固定コピーします。</td>
</tr>
<tr id="L150">
  <td class="line"><a href="#L150">150</a></td>
  <td class="code">  - `meta`: `protocol_id`, `protocol_version`, `importedAt`</td>
</tr>
<tr id="L151">
  <td class="line"><a href="#L151">151</a></td>
  <td class="code">  - `step` 行: `通し番号`, `step_id`, `next_step_id`, `フェーズ`, `状態`, `タイトル`, `表示テキスト`, `警告テキスト`, `必須チェック`</td>
</tr>
<tr id="L152">
  <td class="line"><a href="#L152">152</a></td>
  <td class="code">  - `timer` 指示: `timer_id`, `timer_event`, `timer_exchange_no`, `timer_segment`</td>
</tr>
<tr id="L153">
  <td class="line"><a href="#L153">153</a></td>
  <td class="code">  - `alarm` 指示: `alarm_id`（`timer_event=end` かつ `timer_segment=dwell/drain` 行）</td>
</tr>
<tr id="L154">
  <td class="line"><a href="#L154">154</a></td>
  <td class="code">  - `record` 指示: `record_event`, `record_exchange_no`, `record_unit`</td>
</tr>
<tr id="L155">
  <td class="line"><a href="#L155">155</a></td>
  <td class="code">  - 画像: `画像`（相対パス）を配信用 `assetKey` へ解決した `assetManifest`</td>
</tr>
<tr id="L156">
  <td class="line"><a href="#L156">156</a></td>
  <td class="code">- 固定コピー後に正規化JSONの `snapshotHash(sha256)` を算出して保存します。</td>
</tr>
<tr id="L157">
  <td class="line"><a href="#L157">157</a></td>
  <td class="code">- スナップショット保存に失敗した場合はセッション開始を失敗させます（`SESSION_SNAPSHOT_CREATE_FAILED`）。</td>
</tr>
<tr id="L158">
  <td class="line"><a href="#L158">158</a></td>
  <td class="code">- セッション再開時はスナップショットのみを参照し、テンプレート現行版へフォールバックしません。</td>
</tr>
<tr id="L159">
  <td class="line"><a href="#L159">159</a></td>
  <td class="code">&nbsp;</td>
</tr>
  </table>
</section>
  </main>
</body>
</html>
